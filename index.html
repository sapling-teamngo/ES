<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hayyan Quarries - Interactive Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            overflow: hidden;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            color: white;
            padding: 1rem 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-content {
            flex: 1;
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 0.3rem;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .admin-indicator {
            background-color: #e74c3c;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            display: none;
        }
        
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        #map {
            flex: 1;
            height: 100%;
            z-index: 1;
        }
        
        .sidebar {
            width: 350px;
            background-color: white;
            border-left: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            z-index: 2;
        }
        
        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid #e1e8ed;
        }
        
        .tab-btn {
            flex: 1;
            padding: 1rem;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #7f8c8d;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            color: #3498db;
            border-bottom: 3px solid #3498db;
        }
        
        .tab-content {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
        }
        
        .tab-panel {
            display: none;
        }
        
        .tab-panel.active {
            display: block;
        }
        
        .admin-panel {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .admin-panel h3 {
            margin-bottom: 1rem;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #495057;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .btn-secondary {
            background-color: #95a5a6;
        }
        
        .btn-secondary:hover {
            background-color: #7f8c8d;
        }
        
        .btn-danger {
            background-color: #e74c3c;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .quarry-list {
            flex: 1;
        }
        
        .quarry-item {
            background-color: white;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .quarry-item:hover {
            background-color: #f8f9fa;
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .quarry-item.active {
            background-color: #e1f0fa;
            border-color: #3498db;
        }
        
        .quarry-name {
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }
        
        .quarry-coords {
            font-size: 0.85rem;
            color: #7f8c8d;
        }
        
        .quarry-description {
            font-size: 0.9rem;
            margin-top: 0.5rem;
            color: #5d6d7e;
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .hidden {
            display: none;
        }
        
        .popup-image {
            max-width: 100%;
            max-height: 200px;
            margin-bottom: 0.5rem;
            border-radius: 4px;
        }
        
        .image-gallery {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .image-thumbnail {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .image-thumbnail:hover {
            transform: scale(1.1);
        }
        
        .admin-controls {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .coordinates-input {
            display: flex;
            gap: 0.5rem;
        }
        
        .coordinates-input input {
            flex: 1;
        }
        
        .map-controls {
            position: absolute;
            top: 80px;
            right: 20px;
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            padding: 0.5rem;
            z-index: 1000;
        }
        
        .control-btn {
            padding: 0.5rem;
            margin: 0.25rem;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .legend {
            position: absolute;
            bottom: 30px;
            right: 20px;
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            padding: 0.75rem;
            z-index: 1000;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 0.5rem;
            border-radius: 50%;
        }
        
        .day1-color {
            background-color: #e74c3c;
        }
        
        .day2-color {
            background-color: #3498db;
        }
        
        .new-quarry-color {
            background-color: #2ecc71;
        }
        
        .contour-line {
            stroke: #7f8c8d;
            stroke-width: 1;
            fill: none;
            opacity: 0.7;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            background-color: #2ecc71;
            color: white;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 10000;
            display: none;
        }
        
        .contour-control {
            position: absolute;
            top: 80px;
            left: 20px;
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            padding: 0.75rem;
            z-index: 1000;
        }
        
        .contour-control h4 {
            margin-bottom: 0.5rem;
        }
        
        .contour-slider {
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>Hayyan Quarries Interactive Map</h1>
                <div class="subtitle">Field Trip Data Visualization</div>
            </div>
            <div class="admin-indicator" id="admin-indicator">
                <i class="fas fa-user-shield"></i> Admin Mode
            </div>
        </header>
        
        <div class="main-content">
            <div id="map"></div>
            
            <div class="sidebar">
                <div class="sidebar-tabs">
                    <button class="tab-btn active" data-tab="info-tab">
                        <i class="fas fa-info-circle"></i> Information
                    </button>
                    <button class="tab-btn" data-tab="admin-tab">
                        <i class="fas fa-cog"></i> Admin Panel
                    </button>
                </div>
                
                <div class="tab-content">
                    <div class="tab-panel active" id="info-tab">
                        <h3><i class="fas fa-mountain"></i> Quarries Overview</h3>
                        <p>This map displays the quarries surveyed during the field trip. Click on any quarry marker to see detailed information.</p>
                        
                        <div class="quarry-list" id="quarry-list">
                            <!-- Quarry items will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="tab-panel" id="admin-tab">
                        <div class="admin-panel">
                            <div id="login-section">
                                <h3><i class="fas fa-sign-in-alt"></i> Admin Login</h3>
                                <div class="login-form">
                                    <div class="form-group">
                                        <label for="username">Username</label>
                                        <input type="text" id="username" placeholder="Enter username">
                                    </div>
                                    <div class="form-group">
                                        <label for="password">Password</label>
                                        <input type="password" id="password" placeholder="Enter password">
                                    </div>
                                    <button id="login-btn">
                                        <i class="fas fa-key"></i> Login
                                    </button>
                                </div>
                            </div>
                            
                            <div id="admin-section" class="hidden">
                                <h3><i class="fas fa-edit"></i> Manage Quarries</h3>
                                <div class="form-group">
                                    <label for="quarry-name">Quarry Name</label>
                                    <input type="text" id="quarry-name" placeholder="Enter quarry name">
                                </div>
                                
                                <div class="form-group">
                                    <label for="quarry-coordinates">Coordinates</label>
                                    <div class="coordinates-input">
                                        <input type="number" id="lat" step="0.00001" placeholder="Latitude" value="32.26">
                                        <input type="number" id="lng" step="0.00001" placeholder="Longitude" value="36.15">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="quarry-description">Description</label>
                                    <textarea id="quarry-description" rows="4" placeholder="Enter quarry description"></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label for="quarry-type">Quarry Type</label>
                                    <select id="quarry-type">
                                        <option value="day1">Day 1 Quarry</option>
                                        <option value="day2">Day 2 Quarry</option>
                                        <option value="other">Other Quarry</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="image-upload">Upload Image</label>
                                    <input type="file" id="image-upload" accept="image/*">
                                </div>
                                
                                <div class="admin-controls">
                                    <button id="add-quarry-btn">
                                        <i class="fas fa-plus"></i> Add Quarry
                                    </button>
                                    <button id="update-quarry-btn" class="btn-secondary">
                                        <i class="fas fa-sync"></i> Update
                                    </button>
                                    <button id="delete-quarry-btn" class="btn-danger">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                    <button id="logout-btn" class="btn-secondary">
                                        <i class="fas fa-sign-out-alt"></i> Logout
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="admin-panel">
                            <h3><i class="fas fa-layer-group"></i> Map Layers</h3>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="contour-toggle" checked>
                                    Show Contour Lines
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="map-controls">
            <button class="control-btn" id="zoom-in">
                <i class="fas fa-search-plus"></i>
            </button>
            <button class="control-btn" id="zoom-out">
                <i class="fas fa-search-minus"></i>
            </button>
            <button class="control-btn" id="reset-view">
                <i class="fas fa-globe"></i>
            </button>
        </div>
        
        <div class="contour-control">
            <h4>Contour Settings</h4>
            <div class="form-group">
                <label for="contour-density">Contour Density</label>
                <input type="range" id="contour-density" class="contour-slider" min="1" max="10" value="5">
            </div>
            <div class="form-group">
                <label for="contour-opacity">Contour Opacity</label>
                <input type="range" id="contour-opacity" class="contour-slider" min="1" max="10" value="7">
            </div>
        </div>
        
        <div class="legend">
            <h4>Legend</h4>
            <div class="legend-item">
                <div class="legend-color day1-color"></div>
                <span>Day 1 Quarries</span>
            </div>
            <div class="legend-item">
                <div class="legend-color day2-color"></div>
                <span>Day 2 Quarries</span>
            </div>
            <div class="legend-item">
                <div class="legend-color new-quarry-color"></div>
                <span>New Quarries</span>
            </div>
            <div class="legend-item">
                <div style="width:20px;height:2px;background:#7f8c8d;margin-right:0.5rem;"></div>
                <span>Contour Lines</span>
            </div>
        </div>
        
        <div class="notification" id="notification"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // Initialize the map
        const map = L.map('map').setView([32.26, 36.15], 12);
        
        // Add a tile layer (using OpenStreetMap as base)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        
        // Define quarry data
        let quarries = {
            'day1-quarry1': {
                id: 'day1-quarry1',
                coords: [32.26054, 36.15565],
                name: 'Day 1: Quarry 1',
                description: 'First quarry surveyed on day 1. Notable for its extensive excavation and visible stratification.',
                type: 'day1',
                images: []
            },
            'day1-quarry2': {
                id: 'day1-quarry2',
                coords: [32.25714, 36.15712],
                name: 'Day 1: Quarry 2',
                description: 'Second quarry from day 1. Contains unique mineral deposits in the northern section.',
                type: 'day1',
                images: []
            },
            'day1-quarry3': {
                id: 'day1-quarry3',
                coords: [32.26052, 36.15644],
                name: 'Day 1: Quarry 3',
                description: 'Third quarry surveyed on day 1. Smaller in scale but with interesting geological features.',
                type: 'day1',
                images: []
            },
            'day2-quarry1': {
                id: 'day2-quarry1',
                coords: [32.27659, 36.14886],
                name: 'Day 2: Quarry 1',
                description: 'First quarry from day 2. Larger excavation area with multiple access points.',
                type: 'day2',
                images: []
            },
            'day2-quarry2': {
                id: 'day2-quarry2',
                coords: [32.27537, 36.14820],
                name: 'Day 2: Quarry 2',
                description: 'Second quarry from day 2. Deep excavation with visible rock layers.',
                type: 'day2',
                images: []
            }
        };
        
        // Create markers for each quarry
        const markers = {};
        const quarryList = document.getElementById('quarry-list');
        
        // Function to render quarry list
        function renderQuarryList() {
            quarryList.innerHTML = '';
            Object.keys(quarries).forEach(id => {
                const quarry = quarries[id];
                const quarryItem = document.createElement('div');
                quarryItem.className = 'quarry-item';
                quarryItem.setAttribute('data-id', quarry.id);
                
                let typeClass = '';
                if (quarry.type === 'day1') typeClass = 'day1-color';
                else if (quarry.type === 'day2') typeClass = 'day2-color';
                else typeClass = 'new-quarry-color';
                
                quarryItem.innerHTML = `
                    <div class="quarry-name">
                        <span class="legend-color ${typeClass}" style="display:inline-block; margin-right:8px;"></span>
                        ${quarry.name}
                    </div>
                    <div class="quarry-coords">${quarry.coords[1].toFixed(5)}°, ${quarry.coords[0].toFixed(5)}°</div>
                    <div class="quarry-description">${quarry.description.substring(0, 100)}${quarry.description.length > 100 ? '...' : ''}</div>
                `;
                
                quarryItem.addEventListener('click', function() {
                    highlightQuarry(quarry.id);
                });
                
                quarryList.appendChild(quarryItem);
            });
        }
        
        // Function to create or update a marker
        function updateMarker(quarryId) {
            const quarry = quarries[quarryId];
            
            // Remove existing marker if it exists
            if (markers[quarryId]) {
                map.removeLayer(markers[quarryId]);
            }
            
            // Determine marker color based on type
            let markerColor;
            if (quarry.type === 'day1') markerColor = '#e74c3c';
            else if (quarry.type === 'day2') markerColor = '#3498db';
            else markerColor = '#2ecc71';
            
            // Create custom icon
            const customIcon = L.divIcon({
                className: 'custom-marker',
                html: `<div style="background-color:${markerColor}; width:20px; height:20px; border-radius:50%; border:3px solid white; box-shadow:0 2px 5px rgba(0,0,0,0.3);"></div>`,
                iconSize: [26, 26],
                iconAnchor: [13, 13]
            });
            
            // Create marker
            const marker = L.marker(quarry.coords, { icon: customIcon }).addTo(map);
            
            // Create popup content
            let popupContent = `<h3>${quarry.name}</h3>`;
            popupContent += `<p><strong>Coordinates:</strong> ${quarry.coords[1].toFixed(5)}°, ${quarry.coords[0].toFixed(5)}°</p>`;
            popupContent += `<p>${quarry.description}</p>`;
            
            if (quarry.images.length > 0) {
                popupContent += '<div class="image-gallery">';
                quarry.images.forEach(img => {
                    popupContent += `<img src="${img}" class="image-thumbnail" onclick="openImage('${img}')">`;
                });
                popupContent += '</div>';
            }
            
            marker.bindPopup(popupContent);
            markers[quarryId] = marker;
            
            // Add click event to marker
            marker.on('click', function() {
                highlightQuarry(quarryId);
            });
        }
        
        // Initialize markers and list
        Object.keys(quarries).forEach(id => {
            updateMarker(id);
        });
        renderQuarryList();
        
        // Set map bounds to show all quarries
        const group = new L.featureGroup(Object.values(markers));
        map.fitBounds(group.getBounds().pad(0.1));
        
        // Generate contour lines (simulated)
        let contourLines = [];
        
        function generateContourLines() {
            // Clear existing contour lines
            contourLines.forEach(line => map.removeLayer(line));
            contourLines = [];
            
            const bounds = map.getBounds();
            const north = bounds.getNorth();
            const south = bounds.getSouth();
            const east = bounds.getEast();
            const west = bounds.getWest();
            
            // Get contour settings
            const density = parseInt(document.getElementById('contour-density').value);
            const opacity = parseInt(document.getElementById('contour-opacity').value) / 10;
            
            // Create horizontal contour lines
            for (let i = 0; i < density; i++) {
                const lat = south + (north - south) * (i + 1) / (density + 1);
                
                const contourLine = L.polyline([
                    [lat, west],
                    [lat, east]
                ], {
                    color: '#7f8c8d',
                    weight: 1,
                    opacity: opacity,
                    smoothFactor: 1
                }).addTo(map);
                
                contourLines.push(contourLine);
            }
            
            // Create vertical contour lines
            for (let i = 0; i < density; i++) {
                const lng = west + (east - west) * (i + 1) / (density + 1);
                
                const contourLine = L.polyline([
                    [north, lng],
                    [south, lng]
                ], {
                    color: '#7f8c8d',
                    weight: 1,
                    opacity: opacity,
                    smoothFactor: 1
                }).addTo(map);
                
                contourLines.push(contourLine);
            }
        }
        
        // Generate initial contour lines
        generateContourLines();
        
        // Update contour lines when map moves
        map.on('moveend', function() {
            if (document.getElementById('contour-toggle').checked) {
                generateContourLines();
            }
        });
        
        // Toggle contour lines
        document.getElementById('contour-toggle').addEventListener('change', function() {
            if (this.checked) {
                generateContourLines();
            } else {
                contourLines.forEach(line => map.removeLayer(line));
                contourLines = [];
            }
        });
        
        // Update contour lines when settings change
        document.getElementById('contour-density').addEventListener('input', function() {
            if (document.getElementById('contour-toggle').checked) {
                generateContourLines();
            }
        });
        
        document.getElementById('contour-opacity').addEventListener('input', function() {
            if (document.getElementById('contour-toggle').checked) {
                generateContourLines();
            }
        });
        
        // Admin functionality
        let isAdmin = false;
        let currentQuarry = null;
        
        // Tab functionality
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // Update active tab button
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                // Update active tab panel
                document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
                document.getElementById(tabId).classList.add('active');
            });
        });
        
        // Login function
        document.getElementById('login-btn').addEventListener('click', function() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Simple authentication (in a real app, this would be server-side)
            if (username === 'admin' && password === 'admin') {
                isAdmin = true;
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('admin-section').classList.remove('hidden');
                document.getElementById('admin-indicator').style.display = 'block';
                showNotification('Admin access granted', 'success');
            } else {
                showNotification('Invalid credentials. Try admin/admin for demo.', 'error');
            }
        });
        
        // Logout function
        document.getElementById('logout-btn').addEventListener('click', function() {
            isAdmin = false;
            document.getElementById('login-section').classList.remove('hidden');
            document.getElementById('admin-section').classList.add('hidden');
            document.getElementById('admin-indicator').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            currentQuarry = null;
            resetForm();
            showNotification('Logged out successfully', 'success');
        });
        
        // Add new quarry
        document.getElementById('add-quarry-btn').addEventListener('click', function() {
            if (!isAdmin) {
                showNotification('Please log in as admin first.', 'error');
                return;
            }
            
            const name = document.getElementById('quarry-name').value;
            const lat = parseFloat(document.getElementById('lat').value);
            const lng = parseFloat(document.getElementById('lng').value);
            const description = document.getElementById('quarry-description').value;
            const type = document.getElementById('quarry-type').value;
            
            if (!name || !lat || !lng) {
                showNotification('Please fill in at least name and coordinates.', 'error');
                return;
            }
            
            // Generate a unique ID
            const id = 'quarry-' + Date.now();
            
            // Add to quarries object
            quarries[id] = {
                id: id,
                coords: [lat, lng],
                name: name,
                description: description,
                type: type,
                images: []
            };
            
            // Update map and list
            updateMarker(id);
            renderQuarryList();
            
            // Reset form
            resetForm();
            
            showNotification('Quarry added successfully!', 'success');
        });
        
        // Update quarry
        document.getElementById('update-quarry-btn').addEventListener('click', function() {
            if (!isAdmin) {
                showNotification('Please log in as admin first.', 'error');
                return;
            }
            
            if (!currentQuarry) {
                showNotification('Please select a quarry to update.', 'error');
                return;
            }
            
            const name = document.getElementById('quarry-name').value;
            const lat = parseFloat(document.getElementById('lat').value);
            const lng = parseFloat(document.getElementById('lng').value);
            const description = document.getElementById('quarry-description').value;
            const type = document.getElementById('quarry-type').value;
            
            if (!name || !lat || !lng) {
                showNotification('Please fill in at least name and coordinates.', 'error');
                return;
            }
            
            // Update quarry
            quarries[currentQuarry].name = name;
            quarries[currentQuarry].coords = [lat, lng];
            quarries[currentQuarry].description = description;
            quarries[currentQuarry].type = type;
            
            // Update map and list
            updateMarker(currentQuarry);
            renderQuarryList();
            
            showNotification('Quarry updated successfully!', 'success');
        });
        
        // Delete quarry
        document.getElementById('delete-quarry-btn').addEventListener('click', function() {
            if (!isAdmin) {
                showNotification('Please log in as admin first.', 'error');
                return;
            }
            
            if (!currentQuarry) {
                showNotification('Please select a quarry to delete.', 'error');
                return;
            }
            
            if (confirm('Are you sure you want to delete this quarry?')) {
                // Remove from map
                if (markers[currentQuarry]) {
                    map.removeLayer(markers[currentQuarry]);
                    delete markers[currentQuarry];
                }
                
                // Remove from quarries object
                delete quarries[currentQuarry];
                
                // Update list
                renderQuarryList();
                
                // Reset form
                resetForm();
                currentQuarry = null;
                
                showNotification('Quarry deleted successfully!', 'success');
            }
        });
        
        // Image upload
        document.getElementById('image-upload').addEventListener('change', function(e) {
            if (!isAdmin) {
                showNotification('Please log in as admin first.', 'error');
                return;
            }
            
            if (!currentQuarry) {
                showNotification('Please select a quarry first.', 'error');
                return;
            }
            
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const imageData = event.target.result;
                    quarries[currentQuarry].images.push(imageData);
                    
                    // Update marker popup
                    updateMarker(currentQuarry);
                    
                    showNotification('Image uploaded successfully!', 'success');
                };
                reader.readAsDataURL(file);
            }
            
            // Reset file input
            e.target.value = '';
        });
        
        // Map control buttons
        document.getElementById('zoom-in').addEventListener('click', function() {
            map.zoomIn();
        });
        
        document.getElementById('zoom-out').addEventListener('click', function() {
            map.zoomOut();
        });
        
        document.getElementById('reset-view').addEventListener('click', function() {
            map.fitBounds(group.getBounds().pad(0.1));
        });
        
        // Helper function to highlight quarry
        function highlightQuarry(quarryId) {
            // Remove active class from all quarry items
            document.querySelectorAll('.quarry-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to selected quarry
            document.querySelector(`.quarry-item[data-id="${quarryId}"]`).classList.add('active');
            
            // Open popup for the selected quarry
            markers[quarryId].openPopup();
            
            // If admin, update the admin panel
            if (isAdmin) {
                const quarry = quarries[quarryId];
                document.getElementById('quarry-name').value = quarry.name;
                document.getElementById('lat').value = quarry.coords[0];
                document.getElementById('lng').value = quarry.coords[1];
                document.getElementById('quarry-description').value = quarry.description;
                document.getElementById('quarry-type').value = quarry.type;
                currentQuarry = quarryId;
            }
        }
        
        // Helper function to reset form
        function resetForm() {
            document.getElementById('quarry-name').value = '';
            document.getElementById('lat').value = '32.26';
            document.getElementById('lng').value = '36.15';
            document.getElementById('quarry-description').value = '';
            document.getElementById('quarry-type').value = 'day1';
            document.getElementById('image-upload').value = '';
        }
        
        // Function to show notification
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            
            if (type === 'success') {
                notification.style.backgroundColor = '#2ecc71';
            } else if (type === 'error') {
                notification.style.backgroundColor = '#e74c3c';
            }
            
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // Function to open image in full view
        window.openImage = function(imageSrc) {
            const imageWindow = window.open('', '_blank');
            imageWindow.document.write(`
                <html>
                    <head><title>Quarry Image</title></head>
                    <body style="margin:0; display:flex; justify-content:center; align-items:center; height:100vh; background:#333;">
                        <img src="${imageSrc}" style="max-width:100%; max-height:100%;">
                    </body>
                </html>
            `);
        };
        
        // Add click event to map to add new quarries (admin only)
        map.on('click', function(e) {
            if (isAdmin) {
                // If admin is logged in, prefill coordinates when clicking on the map
                document.getElementById('lat').value = e.latlng.lat.toFixed(5);
                document.getElementById('lng').value = e.latlng.lng.toFixed(5);
            }
        });
    </script>
</body>
</html>
